# fi-transfer-ex2 ООП вариант
Пример решения задачи [Перевод ценных бумаг между счетами с предварительным резервированием средств](../doc/fi-transfer.md) в ООП стиле.

## Подходы использованные в решении
### Onion architecture
Идея в изоляции доменной логики от кода, который содержит обращения к внешнему миру (IO)

### DDD
Класс Account является корнем агрегата. Он содержит информацию как по самому счету, так и по всем блокировкам бумаг на счете. При этом сам класс контролирует свое состояние и выполнение бизнес правил связанных с ним. Работа с блокировками бумаг также проходит только через класс Account, пользовательский код не знает о существовании класса FiTechBlock. 

### ООП
Класс Account реализован в ООП стиле. Данные и код, который с ними работает, находятся в одном месте. Благодаря инкапсуляции невозможно поменять состояние класса в обход методов самого класса.

### Unit test
Благодаря разделению на чистый доменный слой (domain) и слой приложения (application) мы можем протестировать их отдельно.

Бизнес логика сосредоточена в классе Account, для него пишем юнит тесты в классе AccountTest. Сохранив чистоту доменного слоя мы добились следующего:
- При тестировании нам не нужны моки, так как нет внешних зависимостей.
- Тесты не содержат лишнего "шума" от Mockito, поэтому выглядят намного более понятными. 
- Я могу использовать TDD подход, так как тестирование Account представляет собой тестирование черного ящика, мне все равно как он реализован внутри, я проверяю только контракт. 
- В отличие от тестирования с моками, при написании тестов я ни разу не заглянул в имплементацию Account, мне всегда хватало только сигнатуры функций.

### Integration test
Юнит тесты для класса FiTransferService писать не было смысла, почти весь код там это вызов внешних зависимостей, если бы я заменил их все моками, то что бы осталось от кода? Поэтому FiTransferService я тестирую функциональным/интеграционным тестом, не подменяя зависимости (FiTransferServiceTest). 
В идеале нужно было делать это с поднятием тестовой БД с использованием библиотеки TestContainers, но нам хватит и реляционной In memory базы данных H2.
Поскольку в FiTransferService нет ветвлений и арифметических операций - достаточно сделать всего один-два теста на метод, чтобы покрыть 100% кода.